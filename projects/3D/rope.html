<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <title>Gem Test</title>

        <!-- Import gem and all it's dependencies -->
        <script src="js/three.min.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="js/oimo.js"></script>
        <script src="js/gem.js"></script>
    </head>
    <body style="margin: 0px">
        <div id="container"></div>
        <script>
            gem.Create_World();

            //Materials
            var floor_opts = gem.Materials.Generate_Material_Opts();
            floor_opts.Set_Diffuse_Texture(gem.Texture.Load_Tiled_Texture("assets/seamless-moss-2.png"));
            floor_opts.Set_Specular_Texture(gem.Texture.Load_Tiled_Texture("assets/seamless-moss-2_SPECULAR.png"));
            floor_opts.Set_Shininess(35);
            floor_opts.Set_Reflectivity(10);
            var floor_mat = gem.Materials.Create_Phong_Material(floor_opts.GetOpts());

            var rope_opts = gem.Materials.Generate_Material_Opts();
            rope_opts.Set_Color(0x123456);
            //rope_opts.Set_Emissive_Color(0xdddddd);
            rope_opts.Set_Wireframe(true);
            var rope_mat = gem.Materials.Create_Phong_Material(rope_opts.GetOpts);

            //Create all shapes
            gem.Shapes.Create_Static_Plane('floor', [0, -10, 0], [4000, 0.1, 4000], undefined, floor_mat);
            gem.Shapes.Create_Static_Box('obstacle', [0, 0, 0], [100, 150, 300], undefined, floor_mat);
            gem.Shapes.Create_Static_Box('obstacle_1', [0, 85, 140], [100, 20, 20], undefined, floor_mat);
            gem.Shapes.Create_Static_Box('obstacle_2', [0, 85, -140], [100, 20, 20], undefined, floor_mat);

            var max = 21;
            var start_x = -300;
            var n = 5;
            var x = 30;

            var id_list = [];
            for (var i = 0; i < max; i++) {
                gem.Shapes.Create_Dynamic_Cylinder('cyl_' + i, [start_x + (i * x), 200, 0], [n, x, n], [0, 0, 90], rope_mat);
                id_list.push('cyl_' + i);

                //Process Internal Admin work
                while (gem.internal_action_queue.length > 0)
                    (gem.internal_action_queue.pop()).func();


                if (i != 0) {
                    gem.world.oimo_world.add({ type: 'joint', body1: 'cyl_' + (i - 1), body2: 'cyl_' + i, pos1: [0, 16, 0], pos2: [0, -16, 0], min: 2, max: 20, collision: true, spring: [0.5, 0.2] });
                    console.log("Attached: joint cyl_" + (i - 1) + " to cyl_" + i);
                }//End if
            }//End for

            gem.Start();
        </script>
    </body>
</html>
